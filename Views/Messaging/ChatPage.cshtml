@*
    <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Real-Time Chat with SignalR</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.13/signalr.min.js"></script>
</head>
<body>
    <div id="chatContainer">
    <div>
        <input type="text" id="username" placeholder="Enter your username" />
        <input type="text" id="message" placeholder="Enter your message" />
        <button id="sendButton">Send</button>
    </div>
    <div id="chatBox"></div>
    </div>
</body>
</html>

*@

@{

}

<html>
<head>
	<!-- Import this CDN to use icons -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" /></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.13/signalr.min.js" /></script>
	<style>
		#maindiv {
			border: 3px solid black;
			height: 500px;
			width: 1200px;
			margin: auto;
			border-top-left-radius: 10px;
			border-top-right-radius: 10px;
		}

		#chatList {
			list-style-type: none;
			padding-left:0px;
		}

		#leftinnerdiv {
			float: left;
			height: 500px;
			width: 32%;
		}

		button {
			border-radius: 5px;
			width:100%;
		}

		#rightinnerdiv {
			float: left;
			height: 500px;
			width: 32%;
		}

		#chatsAside {
			border-left: 2px solid black;
			float: right;
			height: 500px;
			width: 25%;
			justify-content: flex-start;
			display: flex;
			flex-direction: column
		}

		#li {
			display: inline-block;
			width: 100%;
		}

		#username {
			height: 25px;
			margin-top: 10px;
		}
	</style>
</head>

<body>
	<h2 id="userHeading"></h2>
	<!-- Main container -->

	<div class="container">
		<!-- msg-header section starts -->
		<div class="msg-header">
			<div class="container1">
				@*<img src="user1.png" class="msgimg" />*@
				<div class="active">
				</div>
			</div>
		</div>
		<!-- msg-header section ends -->
		<!-- Chat inbox  -->
		<div class="chat-page">
			<div class="msg-inbox">
				<div class="chats">
					<!-- Message container -->
					<div class="msg-page" id="incmessage">
						<!-- Incoming messages -->
						<div id="maindiv">
							<div id="leftinnerdiv"> </div>
							<div id="rightinnerdiv"></div>
							<div id="chatsAside">
								<input type="text" id="username" placeholder="Username" />
								<ul id="chatList">
									<li>Test Item</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<!-- msg-bottom section -->
				<div class="msg-bottom">
					<div class="input-group">
						<input type="text"
							   id="message"
							   class="form-control"
							   placeholder="Write message..." />
						<span class="input-group-text send-icon" id="sendButton">
							<i class="bi bi-send"></i>
						</span>
					</div>
				</div>
				<div>

					@*<button id="sendButton">Send</button>*@
				</div>
			</div>
		</div>
	</div>
</body>
</html>

<script>
	var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();
	connection.on("ReceiveMessage", function (user, message) {
		var encodedUser = $("<div />").text(user).html();
		var encodedMsg = $("<div />").text(message).html();
		console.log("Message received from: ", encodedUser, "Message: ", encodedMsg);
		$("#leftinnerdiv").append("<p><strong>" + encodedUser + "</strong>: " + encodedMsg + "</p>")

	});
	connection.on("MessageQueued", function (user) {
		var encodedUser = $("<div />").text(user).html();

		console.log(encodedUser, " is offline.Your message has been queued until they return.");

		$("#leftinnerdiv").append("<p><strong> User: " + encodedUser + " is offline. Message is queued.</strong></p>")
	});
	connection.on("ServerDisconnect", function (user) {
		var encodedUser = $("<div />").text(user).html();

		console.log("User: ", encodedUser, " disconnected.The server timed out");

		$("#leftinnerdiv").append("<p><strong>Server Response Timed Out. You have been disconnected.</strong></p>")
	});

	$("#sendButton").click(function () {
		var username

		console.log("clicked");
		if (!username) {
			username = $("#username").val();
		}

		var message = $("#message").val();
		//<a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Home</a>

		if (username && message) {
			//var chatTarget = $("<div />").text(username).html();
			//$("#chatList").append("<li><a class='btn btn-primary' asp-controller='Home' asp-action='Index' id=" + chatTarget+ ">" + chatTarget + "</a></li>");
			connection.invoke("SendMessage", username, message).catch(function (err) {
				var encodedUser = $("<div />").text(username).html();
				var encodedMsg = $("<div />").text(message).html();
				$("#rightinnerdiv").append("<p><strong>" + encodedUser + "</strong>: " + encodedMsg + "</p>")

				return console.error(err.toString());
			});

			$("#message").val("").focus();
		} else if (!username) {
			alert("Please enter your username!");
		}
	});

	connection.start().then(function () {
		console.log("Connected!");
	}).catch(function (err) {
		console.error(err.toString());
	});
</script>

<script>
	function GetUserName() {
		var storedName = sessionStorage.getItem("GuestName");
	}
</script>