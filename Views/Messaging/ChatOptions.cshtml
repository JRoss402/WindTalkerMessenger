@using WindTalkerMessenger.Models.DataLayer
@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@model WindTalkerMessenger.Models.ViewModels.ChatOptionsViewModel


@if(!SignInManager.IsSignedIn(User))
{
    <p>It appears you are not logged in or you are not registered.</p>
    <a class="btn btn-primary" asp-area="Identity" asp-page="/Account/Login">Login</a>
    <a class="btn btn-primary" asp-area="Identity" asp-page="/Account/Register">Register</a>
}
    <form asp-action="Guest" asp-controller="Messaging" method="post" id="guest_form">
        <span id="guestError"></span>
    <input type="text" placeholder="Pick Chat Name" name="chatName" id="chatName" />
        <button type="submit" class="btn btn-primary" id="guestSend" name="guestSend">Start Chatting</button>
    </form>



<script src="~/lib/jquery/dist/jquery.min.js"></script>

<script>
    $("#guestOption").click(function () {
        console.log("Works");
        $("#chatName").toggleClass("recShow");
    })
</script>

<script>
    $("#guestSend").click(function (event) {
        var chatName = $("#chatName").val();
        $.ajax({
            type: "POST",
            url: '@Url.Action("CheckChatName", "API")',
            dataType: "json",
            data: { ChatName: chatName },
            success: function (response) {
                var resp = JSON.parse(response);
                if (resp == true) {
                    sessionStorage.setItem("ChatName", chatName);
                    $("#guest_form").submit();
                    console.log("Worked");
                }
                else{
                    event.preventDefault();

                    $("#guestError").text("That chat name is taken.");
                    console.log("Failed");
                }
            }
        })
    });
</script>